# GeneratePDFButton Component

PDF report generation component that creates comprehensive employee evaluation reports with AI-powered coaching insights.

## Purpose & Usage Context

The GeneratePDFButton component provides PDF report generation functionality for employee evaluations in the A-Player Evaluation System. It integrates with React-PDF renderer and AI services to create professional, styled evaluation reports with coaching recommendations.

**Used in**: Employee analytics pages, performance review interfaces, and report generation workflows.

## Props

| Name | Type | Default | Required | Description |
|------|------|---------|----------|-------------|
| `employee` | `Person` | N/A | Yes | Employee data for report generation |
| `selectedQuarter` | `string` | N/A | Yes | Quarter ID for evaluation period |
| `quarterName` | `string` | `undefined` | No | Quarter display name for report context |
| `disabled` | `boolean` | `false` | No | Whether the button should be disabled |
| `className` | `string` | `''` | No | Additional CSS classes for the container |

## Events & Callbacks

### PDF Generation Process
- **`handleGeneratePDF`**: Initiates the complete PDF generation workflow
- **AI Integration**: Calls AI services for coaching insights and recommendations
- **Report Building**: Constructs PDF using React-PDF renderer

### Progress Updates
- **Stage Updates**: Provides real-time feedback on generation progress
- **Error Handling**: Manages and displays generation errors
- **Completion Notification**: Indicates successful report generation

## Side Effects

### Asynchronous Operations
- **AI API Calls**: Requests coaching insights from OpenAI/Anthropic services
- **Data Fetching**: Retrieves evaluation data for the specified quarter
- **PDF Generation**: Creates and downloads PDF document

### UI State Changes
- **Loading States**: Shows progress indicators during generation
- **Stage Updates**: Displays current generation step to user
- **Error Display**: Shows specific error messages for troubleshooting

### File Operations
- **PDF Download**: Triggers browser download of generated report
- **File Naming**: Uses employee and quarter information for filename

## Accessibility

### Button Accessibility
- **Disabled States**: Proper disabled styling and behavior
- **Loading Feedback**: Screen reader announcements during generation
- **Progress Updates**: Generation stage information accessible

### Error Communication
- **Clear Messages**: Helpful error descriptions for users
- **Retry Guidance**: Instructions for resolving common issues
- **Status Updates**: Real-time progress feedback

## Examples

### Basic Usage
```tsx
import { GeneratePDFButton } from '@/components/ui';

// Simple PDF generation
<GeneratePDFButton 
  employee={employee}
  selectedQuarter={quarterId}
  quarterName="Q4 2024"
/>

// Disabled state
<GeneratePDFButton 
  employee={employee}
  selectedQuarter={quarterId}
  disabled={!hasPermission}
/>
```

### Real Application Usage

#### Employee Analytics Integration (src/pages/EmployeeAnalytics.tsx:200-210)
```tsx
import { GeneratePDFButton } from '@/components/ui';

const EmployeeAnalytics = () => {
  const { employee } = useEmployee(employeeId);
  const { selectedQuarter, quarterName } = useQuarterSelection();
  const { canGenerateReports } = usePermissions();
  
  return (
    <div className="analytics-header">
      <div className="flex justify-between items-center">
        <h1>Employee Analytics</h1>
        
        <div className="actions">
          <GeneratePDFButton 
            employee={employee}
            selectedQuarter={selectedQuarter}
            quarterName={quarterName}
            disabled={!canGenerateReports}
            className="ml-4"
          />
        </div>
      </div>
      
      {/* Analytics content */}
    </div>
  );
};
```

#### Batch Report Generation
```tsx
const BatchReportGenerator = () => {
  const [selectedEmployees, setSelectedEmployees] = useState([]);
  const [generating, setGenerating] = useState(false);
  
  const handleBatchGeneration = async () => {
    setGenerating(true);
    
    for (const employee of selectedEmployees) {
      try {
        await generateEmployeeReport(employee, selectedQuarter);
      } catch (error) {
        console.error(`Failed to generate report for ${employee.name}:`, error);
      }
    }
    
    setGenerating(false);
  };
  
  return (
    <div className="batch-generation">
      <div className="employee-selection">
        {employees.map(employee => (
          <div key={employee.id} className="employee-item">
            <input 
              type="checkbox"
              checked={selectedEmployees.includes(employee)}
              onChange={(e) => {
                if (e.target.checked) {
                  setSelectedEmployees(prev => [...prev, employee]);
                } else {
                  setSelectedEmployees(prev => prev.filter(emp => emp.id !== employee.id));
                }
              }}
            />
            <span>{employee.name}</span>
            
            <GeneratePDFButton 
              employee={employee}
              selectedQuarter={selectedQuarter}
              quarterName={quarterName}
              disabled={generating}
              className="ml-auto"
            />
          </div>
        ))}
      </div>
      
      <Button 
        onClick={handleBatchGeneration}
        disabled={selectedEmployees.length === 0 || generating}
        className="mt-4"
      >
        Generate All Selected Reports
      </Button>
    </div>
  );
};
```

### Error Handling Example
```tsx
const RobustPDFGeneration = () => {
  const [lastError, setLastError] = useState(null);
  const [retryCount, setRetryCount] = useState(0);
  
  const handleGenerationError = (error: string) => {
    setLastError(error);
    setRetryCount(prev => prev + 1);
    
    // Log error for monitoring
    console.error('PDF generation failed:', {
      employee: employee.id,
      quarter: selectedQuarter,
      error,
      retryCount
    });
  };
  
  return (
    <div className="pdf-generation">
      <GeneratePDFButton 
        employee={employee}
        selectedQuarter={selectedQuarter}
        quarterName={quarterName}
        onError={handleGenerationError}
      />
      
      {lastError && (
        <div className="error-feedback mt-2">
          <ErrorMessage 
            message={lastError}
            onRetry={() => {
              setLastError(null);
              // PDF button handles retry automatically
            }}
          />
          
          {retryCount > 2 && (
            <div className="alternative-options mt-2">
              <p className="text-sm text-gray-600">
                Having trouble? Try generating without AI insights:
              </p>
              <Button 
                variant="secondary" 
                size="sm"
                onClick={() => generateBasicReport(employee, selectedQuarter)}
              >
                Generate Basic Report
              </Button>
            </div>
          )}
        </div>
      )}
    </div>
  );
};
```

## PDF Generation Workflow

### Generation Stages
```typescript
const generationStages = [
  'Initializing...',
  'Fetching evaluation data...',
  'Generating AI coaching insights (this may take 1-2 minutes)...',
  'Building PDF document...',
  'Complete!'
];
```

### Error Recovery
```typescript
// Intelligent error handling for common issues
if (errorMessage.includes('timed out')) {
  setError('AI coaching report generation timed out. The PDF was created without AI insights.');
} else if (errorMessage.includes('503')) {
  setError('AI service is temporarily busy. The PDF was created without AI insights.');
} else {
  setError(errorMessage);
}
```

### AI Integration Process
1. **Data Collection**: Fetches employee evaluation data
2. **AI Analysis**: Sends data to OpenAI/Anthropic for coaching insights
3. **Report Assembly**: Combines data and AI insights into PDF structure
4. **PDF Rendering**: Uses React-PDF to generate styled document
5. **Download Trigger**: Initiates browser download

## Styling System

### Button Layout
```css
.pdf-button-container {
  @apply flex flex-col;
}

.pdf-button {
  @apply flex items-center gap-2;
}

.generation-stage {
  @apply mt-2 text-sm text-gray-600 flex items-center gap-2;
}
```

### Loading States
```css
.generating-button {
  @apply opacity-75 cursor-not-allowed;
}

.generation-progress {
  @apply flex items-center gap-2;
}

.stage-indicator {
  @apply text-sm text-gray-600;
}
```

### Error Display
```css
.generation-error {
  @apply mt-2 bg-red-50 border border-red-200 rounded-lg p-3;
}

.error-message {
  @apply text-red-800 text-sm;
}
```

## Performance Considerations

### AI Service Integration
- **Timeout Handling**: Graceful handling of AI service timeouts
- **Fallback Strategy**: PDF generation continues without AI if services fail
- **Rate Limiting**: Respects AI service rate limits

### PDF Generation Optimization
- **Streaming**: Uses React-PDF streaming for large documents
- **Memory Management**: Efficient handling of large evaluation datasets
- **Browser Compatibility**: Works across modern browsers

### User Experience
- **Progress Feedback**: Real-time updates during long operations
- **Error Recovery**: Clear error messages with recovery options
- **Download Management**: Proper file naming and download handling

## Error Types and Solutions

### Common Errors
```typescript
const errorHandling = {
  'timed out': 'AI service timeout - PDF created without AI insights',
  '503': 'AI service busy - PDF created without AI insights', 
  'authentication': 'Please log out and log back in',
  'storage': 'Check bucket permissions and configuration',
  'policy': 'You may not have permission to generate reports'
};
```

### User Guidance
- **Timeout Issues**: Explain AI processing delays
- **Service Unavailable**: Suggest retry timing
- **Permission Errors**: Direct to administrator
- **Network Issues**: Suggest connection check

---

**üìÅ Source Files:**
- **Main Component**: [`src/components/ui/GeneratePDFButton.tsx`](../../a-player-dashboard/src/components/ui/GeneratePDFButton.tsx) (lines 1-112)
- **PDF Service**: [`src/services/reactPdfBuilder.ts`](../../a-player-dashboard/src/services/reactPdfBuilder.ts)
- **Usage Examples**: Found in EmployeeAnalytics and report generation interfaces

**üîó Related Components:**
- [Button](./Button.mdx) - Base button component
- [LoadingSpinner](./LoadingSpinner.mdx) - Progress indication
- [ErrorMessage](./ErrorMessage.mdx) - Error state display
- PDF components (PageWrapper, ScoreCard, etc.) - PDF rendering components
